<div class="chat-bot-container"
  [class.open]="isOpen()"
  [class.closed]="!isOpen()"
>
  <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã–∑–æ–≤–∞ —á–∞—Ç–∞ -->
  <button
    class="chat-toggle-btn"
    (click)="toggleChat()"
    [attr.aria-expanded]="isOpen()"
    aria-label="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç"
  >
    <cds-icon shape="chat-bubble" size="lg"></cds-icon>
  </button>

  <!-- –û–∫–Ω–æ —á–∞—Ç–∞ -->
  @if (isOpen()) {
    <div class="chat-window">
      <div class="chat-header">
        <h3>–ß–∞—Ç —Å –±–æ—Ç–æ–º</h3>
        <button (click)="toggleChat()" aria-label="–ó–∞–∫—Ä—ã—Ç—å —á–∞—Ç">√ó</button>
      </div>

      <div class="chat-body" #chatBody>
        @for (msg of messages(); track msg.id) {
          <div
          class="message-row"
          [class.user]="msg.from === 'user'"
          [class.bot]="msg.from === 'bot'"
          >
<!--            @if (msg.from === 'bot') {-->
<!--  &lt;!&ndash;            <div class="avatar">ü§ñ</div>&ndash;&gt;-->
<!--              <div class="avatar" ><cds-icon shape="administrator" size="lg"></cds-icon></div>-->
<!--            }-->
<!--            <div class="message markdown-body">-->
<!--              @if (msg.type === 'status') {-->
<!--                <div class="status-message">{{ msg.text }}</div>-->
<!--              }-->
<!--              @if (msg.type === 'response') {-->
<!--                <markdown [data]="msg.text"></markdown>-->
<!--              }-->
<!--            </div>-->
<!--            @if (msg.from === 'user') {-->
<!--  &lt;!&ndash;            <div class="avatar">üôÇ</div>&ndash;&gt;-->
<!--              <div class="avatar" ><cds-icon shape="user" size="lg"></cds-icon></div>-->
<!--            }-->
            @if (msg.from === 'bot') {
              <div class="avatar"><cds-icon shape="administrator" size="lg"></cds-icon></div>
            }

            <div class="message markdown-body">
              @if (msg.type === 'status') {
                <div class="status-message">{{ msg.text }}</div>
              }
              @if (msg.type === 'response') {
                @if (msg.from === 'bot') {
                  <markdown [data]="msg.text"></markdown>
                }
                @if (msg.from === 'user') {
                  <div class="plain-text">{{ msg.text }}</div>
                }
              }
            </div>

            @if (msg.from === 'user') {
              <div class="avatar"><cds-icon shape="user" size="lg"></cds-icon></div>
            }
          </div>
        }

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏ -->
        @if (isTyping()) {
          <div class="typing-indicator">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        }
      </div>

      <div class="chat-footer">
        <textarea
          #input
          class="chat-input"
          rows="1"
          placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
          (keydown)="onKeyDown($event, input)"
          (focus)="adjustTextarea(input)"
          (input)="adjustTextarea(input)"
        ></textarea>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ "–í–Ω–∏–∑" -->
      @if (userScrolledUp()) {
        <div class="scroll-down-btn" (click)="scrollToBottom(true)">
          <cds-icon shape="arrow" direction="down"></cds-icon>
        </div>
      }
    </div>
  }
</div>
